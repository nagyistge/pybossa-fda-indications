!function(){function a(a){a.pdfDoc.getPage(a.pageNum).then(function(b){var c=b.getViewport(a.scale);a.canvas.height=c.height,a.canvas.width=c.width;var d={canvasContext:a.ctx,viewport:c};b.render(d)})}function b(a,b){a.pdfDoc.getPage(a.pageNum).then(function(c){1===b&&(a.scale=a.scale+.1,a.scale>=2&&(a.scale=2)),-1===b&&(a.scale=a.scale-.1,a.scale<=0&&(a.scale=.1)),0===b&&(a.scale=.8);var d=c.getViewport(a.scale+.1);a.canvas.height=d.height,a.canvas.width=d.width;var e={canvasContext:a.ctx,viewport:d};c.render(e)})}function c(a){1===a.pageNum?($("#next").removeClass("disabled"),$("#prev").addClass("disabled")):a.pageNum===a.pdfDoc.numPages?($("#prev").removeClass("disabled"),$("#next").addClass("disabled")):($("#next").removeClass("disabled"),$("#prev").removeClass("disabled"))}function d(b){b.pageNum<=1||(b.pageNum--,a(b),$("#currentPage").text(b.pageNum),c(b))}function e(b){b.pageNum>=b.pdfDoc.numPages||(b.pageNum++,a(b),$("#currentPage").text(b.pageNum),c(b))}function f(){pybossa.userProgress("opentrials-fda-indications").done(function(a){var b=Math.round(100*a.done/a.total);$("#progress").css("width",b.toString()+"%"),$("#progress").attr("title",b.toString()+"% completed!"),$("#progress").tooltip({placement:"left"}),$("#total").text(a.total),$("#done").text(a.done)})}function g(a){a.pagination?($("#currentPage").text(a.pageNum),$("#totalPages").text(a.pdfDoc.numPages),$(".btn-navigate").show(),$("#pages").show()):($(".btn-navigate").hide(),$("#pages").hide())}function h(b,c,d){PDFJS.getDocument(b).then(function(e){c.pdfURL=b,c.pdfDoc=e,"undefined"!=typeof d?d.resolve(c):(a(c),g(c))})}PDFJS.disableWorker=!0,pybossa.taskLoaded(function(a,b){if($.isEmptyObject(a))b.resolve(a);else{"completed"==a.state&&($("#answer").hide(),$("#taskcompleted").show());var c=$("<canvas/>",{id:"canvas_"+a.id});c.css("border","1px solid black");var d=$("<div/>",{id:"viewport_"+a.id});d.css("width","100%"),d.css("height","100%"),d.css("overflow","auto"),d.css("display","none"),d.append(c),$("#document-container").append(d),$("#viewport_"+a.id).dragscrollable({dragSelector:"#canvas_"+a.id}),a.canvas=document.getElementById("canvas_"+a.id),a.ctx=document.getElementById("canvas_"+a.id).getContext("2d"),a.scale=.9,a.pagination=void 0===a.info.page,a.pageNum=a.info.page||1;var e=["letter","label"];console.log(a);var f=a.info.documents;a.info.documents=[],e.map(function(b){f.map(function(c,d){return c.name.toLowerCase()==b?(a.info.documents.push(c),void f.splice(d,1)):void 0})}),f.map(function(b,c){a.info.documents.push(b)}),a.info.documents.length>0?(pdfURL=a.info.documents[0].url,h(pdfURL,a,b)):b.resolve(a)}}),pybossa.presentTask(function(i,j){if($.isEmptyObject(i))$(".skeleton").hide(),$("#finish").fadeIn();else{f();var k=Cookies.getJSON("remember_token");if("undefined"!=typeof k)var l=k.split("|")[0];else var l=void 0;i.indications=[],$("#documents-list").html("");for(var m=0;m<i.info.documents.length;m++){var n=i.info.documents[m],o='<option value="'+n.url+'">'+n.name+"</option>";$("#documents-list").append(o)}$("#documents-list").change(function(){i.pdfSource=$(this).val();var a=i.pdfSource;h(a,i)}),$(".additional-indication").remove(),$(".remove-indication").remove(),$(".input-indication").val(""),$("#viewport_"+i.id).show(),g(i),a(i),$("#question h1").text(i.info.question),$("#task-id").text(i.id),$("#loading").hide(),c(i),$(".btn-zoom").off("click").on("click",function(a){b(i,parseInt($(this).attr("value")))}),$(".btn-navigate").off("click").on("click",function(a){return"next"===$(this).attr("value")?void e(i):"prev"===$(this).attr("value")?void d(i):void 0}),$("fieldset#indications").on("click",".remove-indication",function(){var a=$(this).parent("div").index();i.indications.splice(a,1),$(this).parent("div").remove(),console.log("Indications changed: ",i.indications)}),$("fieldset#indications").on("change",".input-indication",function(){var a=$(this).parent("div").index();i.indications[a]={value:$(this).val(),document:i.pdfSource,page:i.pageNum},console.log("Indications changed: ",i.indications)}),$("fieldset#indications").on("keyup",".input-indication",function(){$(this).val()?$(".btn-submit").prop("disabled",!1):$(".btn-submit").prop("disabled",!0)}),$(".add-indication").click(function(){var a='<div><input type="text" name="indication" class="form-control input-indication additional-indication"><a class="btn btn-default remove-indication">Remove</a><br class="additional-indication"></div>';$("fieldset#indications").append(a)}),$(".btn-skip").off("click").on("click",function(){var a={username:l,indications:[],document:i.pdfURL,page:null,skipped:!0};$("#viewport_"+i.id).hide(),pybossa.saveTask(i.id,a).done(function(a){j.resolve(),$("#success").fadeIn(),setTimeout(function(){$("#success").fadeOut()},2e3)})}),$(".btn-submit").off("click").on("click",function(){var a={username:l,indications:i.indications};$("#viewport_"+i.id).hide(),pybossa.saveTask(i.id,a).done(function(a){j.resolve(),$("#success").fadeIn(),setTimeout(function(){$("#success").fadeOut()},2e3)})})}}),pybossa.run("opentrials-fda-indications")}();